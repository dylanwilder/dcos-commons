name: "hdfs"
principal: "hdfs-principal"
zookeeper: master.mesos:2181
api-port: {{PORT0}}
pods:
  journal:
    count: 3
    tasks:
      node:
        goal: RUNNING
        cmd: "echo journal >> journal-data/output && sleep $SLEEP_DURATION"
        cpus: 0.1
        memory: 512
        volumes:
          - path: "journal-data"
            type: ROOT
            size: 5
        env:
          SLEEP_DURATION: "100"
  name:
    count: 2
    resource-sets:
      name-resources:
        cpus: 0.1
        memory: 512
        volumes:
          - path: "name-data"
            type: ROOT
            size: 5
      sidecar-resources:
        cpus: 0.2
        memory: 128
    tasks:
      node:
        goal: RUNNING
        cmd: "echo node >> name-data/output && sleep $SLEEP_DURATION"
        resource-set: name-resources
        env:
          SLEEP_DURATION: "100"
      format:
        goal: FINISHED
        cmd: "echo format >> name-data/output"
        resource-set: name-resources
        env:
          SLEEP_DURATION: "100"
      bootstrap:
        goal: FINISHED
        cmd: "echo bootstrap >> name-data/output"
        resource-set: name-resources
        env:
          SLEEP_DURATION: "100"
      backup:
        goal: FINISHED
        cmd: "echo backup >> name-data/output"
        resource-set: sidecar-resources
        env:
          SLEEP_DURATION: "100"
  zkfc:
    count: 2
    tasks:
      node:
        goal: RUNNING
        cmd: "echo name >> zkfc-data/output && sleep $SLEEP_DURATION"
        cpus: 0.1
        memory: 512
        volumes:
          - path: "zkfc-data"
            type: ROOT
            size: 5
        env:
          SLEEP_DURATION: "100"
  data:
    count: 2
    tasks:
      node:
        goal: RUNNING
        cmd: "echo name >> data-data/output && sleep $SLEEP_DURATION"
        cpus: 0.1
        memory: 512
        volumes:
          - path: "data-data"
            type: ROOT
            size: 5
        env:
          SLEEP_DURATION: "100"

plans:
  deploy:
    strategy: serial
    phases:
      #jn-deploy:
      #  strategy: parallel
      #  pod: journal
      nn-deploy:
        strategy: serial
        pod: name
        steps:
          - podInstance: 0
            tasks: [format]
          #- podInstance: 0
          #  tasks: [node]
          #- podInstance: 1
          #  tasks: [bootstrap]
          #- podInstance: 1
          #  tasks: [node]
      #zkfc-deploy:
      #  strategy: parallel
      #  pod: zkfc
      #dn-deploy:
      #  strategy: parallel
      #  pod: data
