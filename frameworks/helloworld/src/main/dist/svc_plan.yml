name: "data-store"
principal: "data-store-principal"
zookeeper: master.mesos:2181
api-port: {{PORT0}}
pods:
  journal:
    count: 3
    resource-sets:
      journal-resources:
        cpus: 0.1
        memory: 512
        volumes:
          - path: "journal-data"
            type: ROOT
            size: 5000
    tasks:
      node:
        goal: RUNNING
        cmd: "echo journal >> journal-data/output && sleep $SLEEP_DURATION"
        resource-set: journal-resources
        env:
          SLEEP_DURATION: "1000"
  name:
    count: 2
    resource-sets:
      data-store-resources:
        cpus: 0.1
        memory: 512
        volumes:
          - path: "name-data"
            type: ROOT
            size: 5000
    tasks:
      data-store-task:
        goal: RUNNING
        cmd: "echo name >> name-data/output && sleep $SLEEP_DURATION"
        resource-set: data-store-resources
        env:
          SLEEP_DURATION: "1000"
  zkfc:
    count: 2
    resource-sets:
      data-store-resources:
        cpus: 0.1
        memory: 512
        volumes:
          - path: "name-data"
            type: ROOT
            size: 5000
    tasks:
      data-store-task:
        goal: RUNNING
        cmd: "echo name >> name-data/output && sleep $SLEEP_DURATION"
        resource-set: data-store-resources
        env:
          SLEEP_DURATION: "1000"

plans:
  deploy:
    strategy: serial
    phases:
      journal-deploy:
        strategy: serial
        pod: journal
      nn-deploy:
        strategy: serial
        pod: nn
        steps:
          - podInstance: 0
            tasks: [format]
          - podInstance: 0
            tasks: [server]
          - podInstance: 1
            tasks: [format]
          - podInstance: 1
            tasks: [server]
      dn-deploy:
        strategy: serial
        pod: dn
        steps:
          - tasks: [format]
          - tasks: [blah]